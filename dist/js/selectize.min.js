/*! selectize.js - v1.0.1 | https://github.com/selectize/selectize.js | Apache License (v2) */

!function(t,e){"function"==typeof define&&define.amd?define(["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(I,c,t){"use strict";I.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var t=this.parentNode;t.replaceChild(this.firstChild,this),t.normalize()}).end()};function i(){}i.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},i.mixin=function(t){for(var e=["on","off","trigger"],n=0;n<e.length;n++)t.prototype[e[n]]=i.prototype[e[n]]};function p(t){return void 0!==t}function S(t){return null==t?null:"boolean"==typeof t?t?"1":"0":t+""}function a(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function n(e,n,t){var i,o=e.trigger,s={};for(i in e.trigger=function(){var t=arguments[0];if(-1===n.indexOf(t))return o.apply(e,arguments);s[t]=arguments},t.apply(e,[]),e.trigger=o,s)s.hasOwnProperty(i)&&o.apply(e,s[i])}function g(t){var e,n,i={};return"selectionStart"in t?(i.start=t.selectionStart,i.length=t.selectionEnd-i.start):document.selection&&(t.focus(),e=document.selection.createRange(),n=document.selection.createRange().text.length,e.moveStart("character",-t.value.length),i.start=e.text.length-n,i.length=n),i}function w(u){function t(t,e){var n,i,o,s,r,a,l,p,d,c;e=e||{},(t=t||window.event||{}).metaKey||t.altKey||!e.force&&!1===u.data("grow")||(c=u.val(),t.type&&"keydown"===t.type.toLowerCase()&&(i=48<=(n=t.keyCode)&&n<=57||65<=n&&n<=90||96<=n&&n<=111||186<=n&&n<=222||32===n,46===n||8===n?(l=g(u[0])).length?c=c.substring(0,l.start)+c.substring(l.start+l.length):8===n&&l.start?c=c.substring(0,l.start-1)+c.substring(l.start+1):46===n&&void 0!==l.start&&(c=c.substring(0,l.start)+c.substring(l.start+1)):i&&(r=t.shiftKey,a=String.fromCharCode(t.keyCode),c+=a=r?a.toUpperCase():a.toLowerCase())),o=u.attr("placeholder"),!c&&o&&(c=o),d=u,(s=((p=c)?(y.$testInput||(y.$testInput=I("<span />").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).appendTo("body")),y.$testInput.text(p),function(t,e,n){var i,o,s={};if(n)for(i=0,o=n.length;i<o;i++)s[n[i]]=t.css(n[i]);else s=t.css();e.css(s)}(d,y.$testInput,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]),y.$testInput.width()):0)+4)!==h&&(h=s,u.width(s),u.triggerHandler("resize")))}var h=null;u.on("keydown keyup update blur",t),t()}var $=/Mac/.test(navigator.userAgent),b=$?91:17,x=$?18:17,F=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity,y=function(t,e){var n,i,o=this,s=t[0];s.selectize=o;var r,a,l,p,d=window.getComputedStyle&&window.getComputedStyle(s,null);if(p=(p=d?d.getPropertyValue("direction"):s.currentStyle&&s.currentStyle.direction)||t.parents("[dir]:first").attr("dir")||"",I.extend(o,{order:0,settings:e,$input:t,tabIndex:t.attr("tabindex")||"",tagType:"select"===s.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(p),eventNS:".selectize"+ ++y.count,highlightedValue:null,isBlurring:!1,isOpen:!1,isDisabled:!1,isRequired:t.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===e.loadThrottle?o.onSearchChange:(r=o.onSearchChange,a=e.loadThrottle,function(){var t=this,e=arguments;window.clearTimeout(l),l=window.setTimeout(function(){r.apply(t,e)},a)})}),o.sifter=new c(this.options,{diacritics:e.diacritics}),o.settings.options){for(n=0,i=o.settings.options.length;n<i;n++)o.registerOption(o.settings.options[n]);delete o.settings.options}if(o.settings.optgroups){for(n=0,i=o.settings.optgroups.length;n<i;n++)o.registerOptionGroup(o.settings.optgroups[n]);delete o.settings.optgroups}o.settings.mode=o.settings.mode||(1===o.settings.maxItems?"single":"multi"),"boolean"!=typeof o.settings.hideSelected&&(o.settings.hideSelected="multi"===o.settings.mode),o.initializePlugins(o.settings.plugins),o.setupCallbacks(),o.setupTemplates(),o.setup()};return i.mixin(y),void 0!==t?t.mixin(y):function(t,e){e=e||{};console.error("Selectize: "+t),e.explanation&&(console.group&&console.group(),console.error(e.explanation),console.group&&console.groupEnd())}("Dependency MicroPlugin is missing",{explanation:'Make sure you either: (1) are using the "standalone" version of Selectize, or (2) require MicroPlugin before you load Selectize.'}),I.extend(y.prototype,{setup:function(){var t,e,n,i,o,s,r,a=this,l=a.settings,p=a.eventNS,d=I(window),c=I(document),u=a.$input,h=a.settings.mode,g=u.attr("class")||"",f=I("<div>").addClass(l.wrapperClass).addClass(g).addClass(h),v=I("<div>").addClass(l.inputClass).addClass("items").appendTo(f),m=I('<input type="text" autocomplete="off" />').appendTo(v).attr("tabindex",u.is(":disabled")?"-1":a.tabIndex),y=I(l.dropdownParent||f),O=I("<div>").addClass(l.dropdownClass).addClass(h).hide().appendTo(y),C=I("<div>").addClass(l.dropdownContentClass).appendTo(O);(e=u.attr("id"))&&(m.attr("id",e+"-selectized"),I("label[for='"+e+"']").attr("for",e+"-selectized")),a.settings.copyClassesToDropdown&&O.addClass(g),f.css({width:u[0].style.width}),a.plugins.names.length&&(t="plugin-"+a.plugins.names.join(" plugin-"),f.addClass(t),O.addClass(t)),(null===l.maxItems||1<l.maxItems)&&1===a.tagType&&u.attr("multiple","multiple"),a.settings.placeholder&&m.attr("placeholder",l.placeholder),!a.settings.splitOn&&a.settings.delimiter&&(n=a.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),a.settings.splitOn=new RegExp("\\s*"+n+"+\\s*")),u.attr("autocorrect")&&m.attr("autocorrect",u.attr("autocorrect")),u.attr("autocapitalize")&&m.attr("autocapitalize",u.attr("autocapitalize")),m[0].type=u[0].type,a.$wrapper=f,a.$control=v,a.$control_input=m,a.$dropdown=O,a.$dropdown_content=C,O.on("mouseenter mousedown click","[data-disabled]>[data-selectable]",function(t){t.stopImmediatePropagation()}),O.on("mouseenter","[data-selectable]",function(){return a.onOptionHover.apply(a,arguments)}),O.on("mousedown click","[data-selectable]",function(){return a.onOptionSelect.apply(a,arguments)}),o="mousedown",s="*:not(input)",r=function(){return a.onItemSelect.apply(a,arguments)},(i=v).on(o,s,function(t){for(var e=t.target;e&&e.parentNode!==i[0];)e=e.parentNode;return t.currentTarget=e,r.apply(this,[t])}),w(m),v.on({mousedown:function(){return a.onMouseDown.apply(a,arguments)},click:function(){return a.onClick.apply(a,arguments)}}),m.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return a.onKeyDown.apply(a,arguments)},keyup:function(){return a.onKeyUp.apply(a,arguments)},keypress:function(){return a.onKeyPress.apply(a,arguments)},resize:function(){a.positionDropdown.apply(a,[])},blur:function(){return a.onBlur.apply(a,arguments)},focus:function(){return a.ignoreBlur=!1,a.onFocus.apply(a,arguments)},paste:function(){return a.onPaste.apply(a,arguments)}}),c.on("keydown"+p,function(t){a.isCmdDown=t[$?"metaKey":"ctrlKey"],a.isCtrlDown=t[$?"altKey":"ctrlKey"],a.isShiftDown=t.shiftKey}),c.on("keyup"+p,function(t){t.keyCode===x&&(a.isCtrlDown=!1),16===t.keyCode&&(a.isShiftDown=!1),t.keyCode===b&&(a.isCmdDown=!1)}),c.on("mousedown"+p,function(t){if(a.isFocused){if(t.target===a.$dropdown[0]||t.target.parentNode===a.$dropdown[0])return!1;a.$control.has(t.target).length||t.target===a.$control[0]||a.blur(t.target)}}),d.on(["scroll"+p,"resize"+p].join(" "),function(){a.isOpen&&a.positionDropdown.apply(a,arguments)}),d.on("mousemove"+p,function(){a.ignoreHover=!1}),this.revertSettings={$children:u.children().detach(),tabindex:u.attr("tabindex")},u.attr("tabindex",-1).hide().after(a.$wrapper),I.isArray(l.items)&&(a.setValue(l.items),delete l.items),F&&u.on("invalid"+p,function(t){t.preventDefault(),a.isInvalid=!0,a.refreshState()}),a.updateOriginalInput(),a.refreshItems(),a.refreshState(),a.updatePlaceholder(),a.isSetup=!0,u.is(":disabled")&&a.disable(),a.on("change",this.onChange),u.data("selectize",a),u.addClass("selectized"),a.trigger("initialize"),!0===l.preload&&a.onSearchChange("")},setupTemplates:function(){var n=this.settings.labelField,i=this.settings.optgroupLabelField,t={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[i])+"</div>"},option:function(t,e){return'<div class="option">'+e(t[n])+"</div>"},item:function(t,e){return'<div class="item">'+e(t[n])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};this.settings.render=I.extend({},t,this.settings.render)},setupCallbacks:function(){var t,e,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in n)n.hasOwnProperty(t)&&(e=this.settings[n[t]])&&this.on(t,e)},onClick:function(t){this.isFocused&&this.isOpen||(this.focus(),t.preventDefault())},onMouseDown:function(t){var e=this,n=t.isDefaultPrevented();I(t.target);if(e.isFocused){if(t.target!==e.$control_input[0])return"single"===e.settings.mode?e.isOpen?e.close():e.open():n||e.setActiveItem(null),!1}else n||window.setTimeout(function(){e.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var o=this;o.isFull()||o.isInputHidden||o.isLocked?t.preventDefault():o.settings.splitOn&&setTimeout(function(){var t=o.$control_input.val();if(t.match(o.settings.splitOn))for(var e=I.trim(t).split(o.settings.splitOn),n=0,i=e.length;n<i;n++)o.createItem(e[n])},0)},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){t.target,this.$control_input[0];var e,n,i=this;if(i.isLocked)9!==t.keyCode&&t.preventDefault();else{switch(t.keyCode){case 65:if(i.isCmdDown)return void i.selectAll();break;case 27:return void(i.isOpen&&(t.preventDefault(),t.stopPropagation(),i.close()));case 78:if(!t.ctrlKey||t.altKey)break;case 40:return!i.isOpen&&i.hasOptions?i.open():i.$activeOption&&(i.ignoreHover=!0,(e=i.getAdjacentOption(i.$activeOption,1)).length&&i.setActiveOption(e,!0,!0)),void t.preventDefault();case 80:if(!t.ctrlKey||t.altKey)break;case 38:return i.$activeOption&&(i.ignoreHover=!0,(n=i.getAdjacentOption(i.$activeOption,-1)).length&&i.setActiveOption(n,!0,!0)),void t.preventDefault();case 13:return void(i.isOpen&&i.$activeOption&&(i.onOptionSelect({currentTarget:i.$activeOption}),t.preventDefault()));case 37:return void i.advanceSelection(-1,t);case 39:return void i.advanceSelection(1,t);case 9:return i.settings.selectOnTab&&i.isOpen&&i.$activeOption&&(i.onOptionSelect({currentTarget:i.$activeOption}),i.isFull()||t.preventDefault()),void(i.settings.create&&i.createItem()&&t.preventDefault());case 8:case 46:return void i.deleteSelection(t)}!i.isFull()&&!i.isInputHidden||($?t.metaKey:t.ctrlKey)||t.preventDefault()}},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();var n=e.$control_input.val()||"";e.lastValue!==n&&(e.lastValue=n,e.onSearchChange(n),e.refreshOptions(),e.trigger("type",n))},onSearchChange:function(e){var n=this,i=n.settings.load;i&&(n.loadedSearches.hasOwnProperty(e)||(n.loadedSearches[e]=!0,n.load(function(t){i.apply(n,[e,t])})))},onFocus:function(t){var e=this,n=e.isFocused;if(e.isDisabled)return e.blur(),t&&t.preventDefault(),!1;e.ignoreFocus||(e.isFocused=!0,"focus"===e.settings.preload&&e.onSearchChange(""),n||e.trigger("focus"),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState())},onBlur:function(t,e){var n=this;if(n.isFocused&&(n.isFocused=!1,!n.ignoreFocus)){if(!n.ignoreBlur&&document.activeElement===n.$dropdown_content[0])return n.ignoreBlur=!0,void n.onFocus(t);var i=function(){n.close(),n.setTextboxValue(""),n.setActiveItem(null),n.setActiveOption(null),n.setCaret(n.items.length),n.refreshState(),e&&e.focus&&e.focus(),n.isBlurring=!1,n.ignoreFocus=!1,n.trigger("blur")};n.isBlurring=!0,n.ignoreFocus=!0,n.settings.create&&n.settings.createOnBlur?n.createItem(null,!1,i):i()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(t){var e,n,i=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),(n=I(t.currentTarget)).hasClass("create")?i.createItem(null,function(){i.settings.closeAfterSelect&&i.close()}):void 0!==(e=n.attr("data-value"))&&(i.lastQuery=null,i.setTextboxValue(""),i.addItem(e),i.settings.closeAfterSelect?i.close():!i.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&i.setActiveOption(i.getOption(e)))},onItemSelect:function(t){this.isLocked||"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,n=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||n.removeClass(e.settings.loadingClass),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input;e.val()!==t&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t,e){n(this,e?[]:["change"],function(){this.clear(e),this.addItems(t,e)})},setActiveItem:function(t,e){var n,i,o,s,r,a,l,p,d=this;if("single"!==d.settings.mode){if(!(t=I(t)).length)return I(d.$activeItems).removeClass("active"),d.$activeItems=[],void(d.isFocused&&d.showInput());if("mousedown"===(n=e&&e.type.toLowerCase())&&d.isShiftDown&&d.$activeItems.length){for(p=d.$control.children(".active:last"),s=Array.prototype.indexOf.apply(d.$control[0].childNodes,[p[0]]),(r=Array.prototype.indexOf.apply(d.$control[0].childNodes,[t[0]]))<s&&(l=s,s=r,r=l),i=s;i<=r;i++)a=d.$control[0].childNodes[i],-1===d.$activeItems.indexOf(a)&&(I(a).addClass("active"),d.$activeItems.push(a));e.preventDefault()}else"mousedown"===n&&d.isCtrlDown||"keydown"===n&&this.isShiftDown?t.hasClass("active")?(o=d.$activeItems.indexOf(t[0]),d.$activeItems.splice(o,1),t.removeClass("active")):d.$activeItems.push(t.addClass("active")[0]):(I(d.$activeItems).removeClass("active"),d.$activeItems=[t.addClass("active")[0]]);d.hideInput(),this.isFocused||d.focus()}},setActiveOption:function(t,e,n){var i,o,s,r,a,l=this;l.$activeOption&&l.$activeOption.removeClass("active"),l.$activeOption=null,(t=I(t)).length&&(l.$activeOption=t.addClass("active"),!e&&p(e)||(i=l.$dropdown_content.height(),o=l.$activeOption.outerHeight(!0),e=l.$dropdown_content.scrollTop()||0,a=(r=s=l.$activeOption.offset().top-l.$dropdown_content.offset().top+e)-i+o,i+e<s+o?l.$dropdown_content.stop().animate({scrollTop:a},n?l.settings.scrollDuration:0):s<e&&l.$dropdown_content.stop().animate({scrollTop:r},n?l.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==t.settings.mode&&(t.$activeItems=Array.prototype.slice.apply(t.$control.children(":not(input)").addClass("active")),t.$activeItems.length&&(t.hideInput(),t.close()),t.focus())},hideInput:function(){this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(t){this.$control_input[0].blur(),this.onBlur(null,t)},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e=[{field:e}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e,nesting:t.nesting}},search:function(t){var e,n,i,o=this,s=o.settings,r=this.getSearchOptions();if(s.score&&"function"!=typeof(i=o.settings.score.apply(this,[t])))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==o.lastQuery?(o.lastQuery=t,n=o.sifter.search(t,I.extend(r,{score:i})),o.currentResults=n):n=I.extend(!0,{},o.currentResults),s.hideSelected)for(e=n.items.length-1;0<=e;e--)-1!==o.items.indexOf(S(n.items[e].id))&&n.items.splice(e,1);return n},refreshOptions:function(t){var e,n,i,o,s,r,a,l,p,d,c,u,h,g,f;void 0===t&&(t=!0);var v,m,y=this,O=I.trim(y.$control_input.val()),C=y.search(O),w=y.$dropdown_content,$=y.$activeOption&&S(y.$activeOption.attr("data-value")),b=C.items.length;for("number"==typeof y.settings.maxOptions&&(b=Math.min(b,y.settings.maxOptions)),o={},s=[],e=0;e<b;e++)for(r=y.options[C.items[e].id],a=y.render("option",r),l=r[y.settings.optgroupField]||"",n=0,i=(p=I.isArray(l)?l:[l])&&p.length;n<i;n++)l=p[n],y.optgroups.hasOwnProperty(l)||(l=""),o.hasOwnProperty(l)||(o[l]=document.createDocumentFragment(),s.push(l)),o[l].appendChild(a);for(this.settings.lockOptgroupOrder&&s.sort(function(t,e){return(y.optgroups[t].$order||0)-(y.optgroups[e].$order||0)}),d=document.createDocumentFragment(),e=0,b=s.length;e<b;e++)l=s[e],y.optgroups.hasOwnProperty(l)&&o[l].childNodes.length?((c=document.createDocumentFragment()).appendChild(y.render("optgroup_header",y.optgroups[l])),c.appendChild(o[l]),d.appendChild(y.render("optgroup",I.extend({},y.optgroups[l],{html:(v=c,m=void 0,(m=document.createElement("div")).appendChild(v.cloneNode(!0)),m.innerHTML),dom:c})))):d.appendChild(o[l]);if(w.html(d),y.settings.highlight&&(w.removeHighlight(),C.query.length&&C.tokens.length))for(e=0,b=C.tokens.length;e<b;e++)!function(t,e){if("string"!=typeof e||e.length){var l="string"==typeof e?new RegExp(e,"i"):e,p=function(t){var e=0;if(3===t.nodeType){var n,i,o,s,r=t.data.search(l);0<=r&&0<t.data.length&&(n=t.data.match(l),(i=document.createElement("span")).className="highlight",(o=t.splitText(r)).splitText(n[0].length),s=o.cloneNode(!0),i.appendChild(s),o.parentNode.replaceChild(i,o),e=1)}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&("highlight"!==t.className||"SPAN"!==t.tagName))for(var a=0;a<t.childNodes.length;++a)a+=p(t.childNodes[a]);return e};t.each(function(){p(this)})}}(w,C.tokens[e].regex);if(!y.settings.hideSelected)for(e=0,b=y.items.length;e<b;e++)y.getOption(y.items[e]).addClass("selected");(u=y.canCreate(O))&&(w.prepend(y.render("option_create",{input:O})),f=I(w[0].childNodes[0])),y.hasOptions=0<C.items.length||u,y.hasOptions?(0<C.items.length?((g=$&&y.getOption($))&&g.length?h=g:"single"===y.settings.mode&&y.items.length&&(h=y.getOption(y.items[0])),h&&h.length||(h=f&&!y.settings.addPrecedence?y.getAdjacentOption(f,1):w.find("[data-selectable]:first"))):h=f,y.setActiveOption(h),t&&!y.isOpen&&y.open()):(y.setActiveOption(null),t&&y.isOpen&&y.close())},addOption:function(t){var e,n,i,o=this;if(I.isArray(t))for(e=0,n=t.length;e<n;e++)o.addOption(t[e]);else(i=o.registerOption(t))&&(o.userOptions[i]=!0,o.lastQuery=null,o.trigger("option_add",i,t))},registerOption:function(t){var e=S(t[this.settings.valueField]);return null!=e&&!this.options.hasOwnProperty(e)&&(t.$order=t.$order||++this.order,this.options[e]=t,e)},registerOptionGroup:function(t){var e=S(t[this.settings.optgroupValueField]);return!!e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)},addOptionGroup:function(t,e){e[this.settings.optgroupValueField]=t,(t=this.registerOptionGroup(e))&&this.trigger("optgroup_add",t,e)},removeOptionGroup:function(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.renderCache={},this.trigger("optgroup_remove",t))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,e){var n,i,o,s,r,a,l,p=this;if(t=S(t),o=S(e[p.settings.valueField]),null!==t&&p.options.hasOwnProperty(t)){if("string"!=typeof o)throw new Error("Value must be set in option data");l=p.options[t].$order,o!==t&&(delete p.options[t],-1!==(s=p.items.indexOf(t))&&p.items.splice(s,1,o)),e.$order=e.$order||l,p.options[o]=e,r=p.renderCache.item,a=p.renderCache.option,r&&(delete r[t],delete r[o]),a&&(delete a[t],delete a[o]),-1!==p.items.indexOf(o)&&(n=p.getItem(t),i=I(p.render("item",e)),n.hasClass("active")&&i.addClass("active"),n.replaceWith(i)),p.lastQuery=null,p.isOpen&&p.refreshOptions(!1)}},removeOption:function(t,e){var n=this;t=S(t);var i=n.renderCache.item,o=n.renderCache.option;i&&delete i[t],o&&delete o[t],delete n.userOptions[t],delete n.options[t],n.lastQuery=null,n.trigger("option_remove",t),n.removeItem(t,e)},clearOptions:function(){var n=this;n.loadedSearches={},n.userOptions={},n.renderCache={};var i=n.options;I.each(n.options,function(t,e){-1==n.items.indexOf(t)&&delete i[t]}),n.options=n.sifter.items=i,n.lastQuery=null,n.trigger("option_clear")},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,e){var n=this.$dropdown.find("[data-selectable]"),i=n.index(t)+e;return 0<=i&&i<n.length?n.eq(i):I()},getElementWithValue:function(t,e){if(null!=(t=S(t)))for(var n=0,i=e.length;n<i;n++)if(e[n].getAttribute("data-value")===t)return I(e[n]);return I()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(t,e){this.buffer=document.createDocumentFragment();for(var n=this.$control[0].childNodes,i=0;i<n.length;i++)this.buffer.appendChild(n[i]);for(var o=I.isArray(t)?t:[t],i=0,s=o.length;i<s;i++)this.isPending=i<s-1,this.addItem(o[i],e);var r=this.$control[0];r.insertBefore(this.buffer,r.firstChild),this.buffer=null},addItem:function(a,l){n(this,l?[]:["change"],function(){var t,e,n,i,o,s=this,r=s.settings.mode;a=S(a),-1===s.items.indexOf(a)?s.options.hasOwnProperty(a)&&("single"===r&&s.clear(l),"multi"===r&&s.isFull()||(t=I(s.render("item",s.options[a])),o=s.isFull(),s.items.splice(s.caretPos,0,a),s.insertAtCaret(t),s.isPending&&(o||!s.isFull())||s.refreshState(),s.isSetup&&(n=s.$dropdown_content.find("[data-selectable]"),s.isPending||(e=s.getOption(a),i=s.getAdjacentOption(e,1).attr("data-value"),s.refreshOptions(s.isFocused&&"single"!==r),i&&s.setActiveOption(s.getOption(i))),!n.length||s.isFull()?s.close():s.isPending||s.positionDropdown(),s.updatePlaceholder(),s.trigger("item_add",a,t),s.isPending||s.updateOriginalInput({silent:l})))):"single"===r&&s.close()})},removeItem:function(t,e){var n,i,o=this,s=t instanceof I?t:o.getItem(t);t=S(s.attr("data-value")),-1!==(n=o.items.indexOf(t))&&(s.remove(),s.hasClass("active")&&(i=o.$activeItems.indexOf(s[0]),o.$activeItems.splice(i,1)),o.items.splice(n,1),o.lastQuery=null,!o.settings.persist&&o.userOptions.hasOwnProperty(t)&&o.removeOption(t,e),n<o.caretPos&&o.setCaret(o.caretPos-1),o.refreshState(),o.updatePlaceholder(),o.updateOriginalInput({silent:e}),o.positionDropdown(),o.trigger("item_remove",t,s))},createItem:function(t,n){var i=this,o=i.caretPos;t=t||I.trim(i.$control_input.val()||"");var s=arguments[arguments.length-1];if("function"!=typeof s&&(s=function(){}),"boolean"!=typeof n&&(n=!0),!i.canCreate(t))return s(),!1;i.lock();var e,r,a="function"==typeof i.settings.create?this.settings.create:function(t){var e={};return e[i.settings.labelField]=t,e[i.settings.valueField]=t,e},l=(r=!(e=function(t){if(i.unlock(),!t||"object"!=typeof t)return s();var e=S(t[i.settings.valueField]);if("string"!=typeof e)return s();i.setTextboxValue(""),i.addOption(t),i.setCaret(o),i.addItem(e),i.refreshOptions(n&&"single"!==i.settings.mode),s(t)}),function(){r||(r=!0,e.apply(this,arguments))}),p=a.apply(this,[t,l]);return void 0!==p&&l(p),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){this.refreshValidityState(),this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return!1;var t=!this.items.length;this.isInvalid=t,this.$control_input.prop("required",t),this.$input.prop("required",!t)},refreshClasses:function(){var t=this,e=t.isFull(),n=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",n).toggleClass("full",e).toggleClass("not-full",!e).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!I.isEmptyObject(t.options)).toggleClass("has-items",0<t.items.length),t.$control_input.data("grow",!e&&!n)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(t){var e,n,i,o,s=this;if(t=t||{},1===s.tagType){for(i=[],e=0,n=s.items.length;e<n;e++)o=s.options[s.items[e]][s.settings.labelField]||"",i.push('<option value="'+a(s.items[e])+'" selected="selected">'+a(o)+"</option>");i.length||this.$input.attr("multiple")||i.push('<option value="" selected="selected"></option>'),s.$input.html(i.join(""))}else s.$input.val(s.getValue()),s.$input.attr("value",s.$input.val());s.isSetup&&(t.silent||s.trigger("change",s.$input.val()))},updatePlaceholder:function(){var t;this.settings.placeholder&&(t=this.$control_input,this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0}))},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(),t.isOpen=!0,t.refreshState(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",t.$dropdown))},close:function(){var t=this,e=t.isOpen;"single"===t.settings.mode&&t.items.length&&(t.hideInput(),t.isBlurring||t.$control_input.blur()),t.isOpen=!1,t.$dropdown.hide(),t.setActiveOption(null),t.refreshState(),e&&t.trigger("dropdown_close",t.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t[0].getBoundingClientRect().width,top:e.top,left:e.left})},clear:function(t){var e=this;e.items.length&&(e.$control.children(":not(input)").remove(),e.items=[],e.lastQuery=null,e.setCaret(0),e.setActiveItem(null),e.updatePlaceholder(),e.updateOriginalInput({silent:t}),e.refreshState(),e.showInput(),e.trigger("clear"))},insertAtCaret:function(t){var e=Math.min(this.caretPos,this.items.length),n=t[0],i=this.buffer||this.$control[0];0===e?i.insertBefore(n,i.firstChild):i.insertBefore(n,i.childNodes[e]),this.setCaret(e+1)},deleteSelection:function(t){var e,n,i,o,s,r,a,l=this,p=t&&8===t.keyCode?-1:1,d=g(l.$control_input[0]);if(l.$activeOption&&!l.settings.hideSelected&&(s=l.getAdjacentOption(l.$activeOption,-1).attr("data-value")),i=[],l.$activeItems.length){for(a=l.$control.children(".active:"+(0<p?"last":"first")),o=l.$control.children(":not(input)").index(a),0<p&&o++,e=0,n=l.$activeItems.length;e<n;e++)i.push(I(l.$activeItems[e]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(l.isFocused||"single"===l.settings.mode)&&l.items.length&&(p<0&&0===d.start&&0===d.length?i.push(l.items[l.caretPos-1]):0<p&&d.start===l.$control_input.val().length&&i.push(l.items[l.caretPos]));if(!i.length||"function"==typeof l.settings.onDelete&&!1===l.settings.onDelete.apply(l,[i]))return!1;for(void 0!==o&&l.setCaret(o);i.length;)l.removeItem(i.pop());return l.showInput(),l.positionDropdown(),l.refreshOptions(!0),s&&(r=l.getOption(s)).length&&l.setActiveOption(r),!0},advanceSelection:function(t,e){var n,i,o,s,r,a=this;0!==t&&(a.rtl&&(t*=-1),n=0<t?"last":"first",i=g(a.$control_input[0]),a.isFocused&&!a.isInputHidden?(s=a.$control_input.val().length,(t<0?0!==i.start||0!==i.length:i.start!==s)||s||a.advanceCaret(t,e)):(r=a.$control.children(".active:"+n)).length&&(o=a.$control.children(":not(input)").index(r),a.setActiveItem(null),a.setCaret(0<t?o+1:o)))},advanceCaret:function(t,e){var n,i,o=this;0!==t&&(n=0<t?"next":"prev",o.isShiftDown?(i=o.$control_input[n]()).length&&(o.hideInput(),o.setActiveItem(i),e&&e.preventDefault()):o.setCaret(o.caretPos+t))},setCaret:function(t){var e=this;if(t="single"===e.settings.mode?e.items.length:Math.max(0,Math.min(e.items.length,t)),!e.isPending)for(var n,i=e.$control.children(":not(input)"),o=0,s=i.length;o<s;o++)n=I(i[o]).detach(),o<t?e.$control_input.before(n):e.$control.append(n);e.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.$control_input.prop("disabled",!1).prop("tabindex",t.tabIndex),t.isDisabled=!1,t.unlock()},destroy:function(){var t=this,e=t.eventNS,n=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(n.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:n.tabindex}).show(),t.$control_input.removeData("grow"),t.$input.removeData("selectize"),0==--y.count&&y.$testInput&&(y.$testInput.remove(),y.$testInput=void 0),I(window).off(e),I(document).off(e),I(document.body).off(e),delete t.$input[0].selectize},render:function(t,e){var n,i,o="",s=!1,r=this;return"option"!==t&&"item"!==t||(s=!!(n=S(e[r.settings.valueField]))),s&&(p(r.renderCache[t])||(r.renderCache[t]={}),r.renderCache[t].hasOwnProperty(n))?r.renderCache[t][n]:(o=I(r.settings.render[t].apply(this,[e,a])),"option"===t||"option_create"===t?e[r.settings.disabledField]||o.attr("data-selectable",""):"optgroup"===t&&(i=e[r.settings.optgroupValueField]||"",o.attr("data-group",i),e[r.settings.disabledField]&&o.attr("data-disabled","")),"option"!==t&&"item"!==t||o.attr("data-value",n||""),s&&(r.renderCache[t][n]=o[0]),o[0])},clearCache:function(t){void 0===t?this.renderCache={}:delete this.renderCache[t]},canCreate:function(t){if(!this.settings.create)return!1;var e=this.settings.createFilter;return t.length&&("function"!=typeof e||e.apply(this,[t]))&&("string"!=typeof e||new RegExp(e).test(t))&&(!(e instanceof RegExp)||e.test(t))}}),y.count=0,y.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},I.fn.selectize=function(o){function s(t,r){function a(t){var e=c&&t.attr(c);return"string"==typeof e&&e.length?JSON.parse(e):null}function l(t,e){t=I(t);var n,i,o=S(t.val());(o||d.allowEmptyOption)&&(p.hasOwnProperty(o)?e&&((n=p[o][f])?I.isArray(n)?n.push(e):p[o][f]=[n,e]:p[o][f]=e):((i=a(t)||{})[u]=i[u]||t.text(),i[h]=i[h]||o,i[g]=i[g]||t.prop("disabled"),i[f]=i[f]||e,p[o]=i,s.push(i),t.is(":selected")&&r.items.push(o)))}var e,n,i,o,s=r.options,p={};for(r.maxItems=t.attr("multiple")?null:1,e=0,n=(o=t.children()).length;e<n;e++)"optgroup"===(i=o[e].tagName.toLowerCase())?function(t){var e,n,i,o,s;for((i=(t=I(t)).attr("label"))&&((o=a(t)||{})[v]=i,o[m]=i,o[g]=t.prop("disabled"),r.optgroups.push(o)),e=0,n=(s=I("option",t)).length;e<n;e++)l(s[e],i)}(o[e]):"option"===i&&l(o[e])}var r=I.fn.selectize.defaults,d=I.extend({},r,o),c=d.dataAttr,u=d.labelField,h=d.valueField,g=d.disabledField,f=d.optgroupField,v=d.optgroupLabelField,m=d.optgroupValueField;return this.each(function(){var t,e,n,i;this.selectize||(t=I(this),e=this.tagName.toLowerCase(),(n=t.attr("placeholder")||t.attr("data-placeholder"))||d.allowEmptyOption||(n=t.children('option[value=""]').text()),("select"===e?s:function(t,e){var n,i,o,s,r=t.attr(c);if(r)for(e.options=JSON.parse(r),n=0,i=e.options.length;n<i;n++)e.items.push(e.options[n][h]);else{var a=I.trim(t.val()||"");if(!d.allowEmptyOption&&!a.length)return;for(n=0,i=(o=a.split(d.delimiter)).length;n<i;n++)(s={})[u]=o[n],s[h]=o[n],e.options.push(s);e.items=o}})(t,i={placeholder:n,options:[],optgroups:[],items:[]}),new y(t,I.extend(!0,{},r,i,o)))})},I.fn.selectize.defaults=y.defaults,I.fn.selectize.support={validity:F},y});